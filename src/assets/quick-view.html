<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      html,
      body {
        display: grid;
        overflow: hidden;
        width: 100%;
        height: 100%;
        margin: 0;
      }
    </style>
    <script type="module">
      // const pm = window.parent.postMessage.bind(window.parent);
      let res;
      let module = new Promise((r) => (res = r));
      onmessage = (e) => {
        switch (e.data?.type) {
          case "init":
            if (e.data.js) {
              import("data:text/javascript;base64," + btoa(e.data.js)).then((m) => {
                m.init?.();
                res(m);
              });
            }
            break;
          case "content":
            setTimeout(() => {
              if (e.data.content) {
                module.then((m) => m.updateContent?.(e.data.content, e.data.path));
              }
            }, 0);
            break;
        }
      };
      delete window.parent;
    </script>
  </head>
</html>
